<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL - MTECH</title>
    <link rel="stylesheet" href="./codemirror/codemirror.css">
    <script src="./codemirror/codemirror.min.js"></script>
    <script src="./codemirror/codemirror.min_sql.js"></script>


    <style>
        body {
            font-family: "Segoe UI",Arial,sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Top section */
        .top-section {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            background-color: #f2f2f2;
        }

        .container {
            display: flex;
            align-items: center;
        }

        p {
            margin: 0 10px 0 0;
        }

        .input-container {
            display: flex;
            align-items: center;
        }

        .input-box {
            text-align: center;
            width: 50px;
            margin: 0 5px;
        }

        button {
            padding: 10px 20px;
            background-color: black;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 8px;
        }

        .connect-button {
            padding: 10px 20px;
            background-color: black;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 12px;
            border-radius: 8px;
        }

        button:hover {
            background-color: #444;
        }

        /* Middle section 2 columns */
        .two-column-section {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            background-color: #e0e0e0;
        }

        .first-column {
            flex: 1;
            padding: 10px;
            background-color: #ffffff;
            margin-right: 20px;
        }

        .second-column {
            width: 20%;
            padding: 10px;
            background-color: #ffffff;
        }

        /* Bottom section 1 column */
        .single-column-section {
            display: flex;
            justify-content: center;
            padding: 20px;
            background-color: #d1d1d1;
        }

        .single-column {
            width: 100%;
            padding: 10px;
            background-color: #ffffff;
        }

        /* Content styling */
        .card {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        ul {
            list-style-type: disc;
            margin-left: 20px;
        }

        h2 {
            color: #333;
        }

        /* Query box styles */
        .query-box {
            width: 100%;
            height: 200px;
            resize: none;
            box-sizing: border-box;
            padding: 10px;
            font-family: "Segoe UI",Arial,sans-serif;
            border: 1px solid #ccc;
            margin-top: 10px;
            font-size: 20px;
            background-color: #f9f9f9;
            color: #000;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .query-submit-button {
            margin-top: 10px;
        }

        .query-submit-button button {
            padding: 10px 20px;
            background-color: black;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        .query-submit-button button:hover {
            background-color: #444;
        }

        /* Non-editable log box */
        .results-box {
            width: 100%;
            height: 150px;
            resize: none;
            box-sizing: border-box;
            padding: 10px;
            font-family: "Segoe UI",Arial,sans-serif;
            border: 1px solid #ccc;
            margin-top: 10px;
            font-size: 14px;
            background-color: #f9f9f9;
            color: #000;
            white-space: pre-wrap;
            word-wrap: break-word;
        }


        /* List styles for TableName links */
        .table-name-list a {
            display: block;
            color: black;
            text-decoration: underline;
            margin: 5px 0;
        }

        /* Generic Table Styling */
        .generic-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .generic-table th,
        .generic-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        .generic-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .generic-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .generic-table tr:hover {
            background-color: #f1f1f1;
        }


    </style>
</head>
<body>

<!-- Top Section (Server IP form) -->
<div class="top-section">
    <div class="container">
        <p>Server IP:</p>
        <div class="input-container">
            <input type="number" class="input-box" id="input1" maxlength="3" placeholder="000" oninput="limitInput(this, 3)">
            <span>.</span>
            <input type="number" class="input-box" id="input2" maxlength="2" placeholder="000" oninput="limitInput(this, 3)">
            <span>.</span>
            <input type="number" class="input-box" id="input3" maxlength="2" placeholder="000" oninput="limitInput(this, 3)">
            <span>.</span>
            <input type="number" class="input-box" id="input4" maxlength="3" placeholder="000" oninput="limitInput(this, 3)">
        </div>
        <button class="connect-button" onclick="saveServerIP()">Connect</button>
    </div>
</div>

<!-- Second Section (Two columns) -->
<div class="two-column-section">
    <!-- Left Column: Query Section -->
    <div class="first-column">
        <h2>Query</h2>
        <!-- Input box for query  -->
        <textarea id="query-input" class="query-box" spellcheck="false" placeholder="Enter your SQL query here..."></textarea>
        <div class="query-submit-button">
            <button onclick="submitQuery()">Submit</button>
        </div>
        <!-- Right Column: Display log info -->
        <div>
            <h3>Results</h3>
            <!-- text box to display logs -->
            <textarea id="results-box" class="results-box" placeholder="Configure Server IP" readonly></textarea>
        </div>
    </div>
    
    <!-- Right Column: Table Names List -->
    <div class="second-column">
        <h3>Table Names</h3>
        <div class="table-name-list">
            <a href="#">TableName0</a>
            <a href="#">TableName1</a>
            <a href="#">TableName2</a>
            <a href="#">TableName3</a>
            <a href="#">TableName4</a>
            <a href="#">TableName5</a>
            <a href="#">TableName6</a>
            <a href="#">TableName7</a>
            <a href="#">TableName8</a>
            <a href="#">TableName9</a>
            <a href="#">TableName10</a>
        </div>
    </div>
</div>


<!-- Third Section (Single column) -->
<div class="single-column-section">
    <div class="single-column">
        <h2>Employee Data</h2>
        
        <!-- Table with Employee Data -->
        <table class="generic-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Position</th>
                    <th>Department</th>
                    <th>Salary</th>
                </tr>
            </thead>
            <tbody>
                <!-- Employee records -->
                <tr>
                    <td>1</td>
                    <td>John Doe</td>
                    <td>Software Engineer</td>
                    <td>Engineering</td>
                    <td>$80,000</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Jane Smith</td>
                    <td>Product Manager</td>
                    <td>Product</td>
                    <td>$95,000</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Robert Brown</td>
                    <td>Designer</td>
                    <td>Design</td>
                    <td>$75,000</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>Emily Johnson</td>
                    <td>Data Scientist</td>
                    <td>Data</td>
                    <td>$90,000</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>Michael Davis</td>
                    <td>Product Designer</td>
                    <td>Design</td>
                    <td>$85,000</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>Alice Wilson</td>
                    <td>HR Manager</td>
                    <td>HR</td>
                    <td>$70,000</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>Chris Miller</td>
                    <td>Marketing Specialist</td>
                    <td>Marketing</td>
                    <td>$60,000</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>Linda Moore</td>
                    <td>Accountant</td>
                    <td>Finance</td>
                    <td>$65,000</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>James Taylor</td>
                    <td>Sales Manager</td>
                    <td>Sales</td>
                    <td>$100,000</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>Patricia Garcia</td>
                    <td>Operations Manager</td>
                    <td>Operations</td>
                    <td>$95,000</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


<script>

    const SQL_editor = CodeMirror.fromTextArea(document.getElementById("query-input"), {
    mode: "text/x-sql",
    htmlMode: false,
    lineWrapping: true,
    smartIndent: false,
    addModeClass: true,
    lineNumbers: true,
    })

    // Function to limit the input to a specific number of characters
    function limitInput(input, length) {
        if (input.value.length > length) {
            input.value = input.value.slice(0, length);
        }
    }

    // Function to save the server IP to localStorage
    function saveServerIP() {
        // Get the values from the input boxes
        const input1 = document.getElementById("input1").value;
        const input2 = document.getElementById("input2").value;
        const input3 = document.getElementById("input3").value;
        const input4 = document.getElementById("input4").value;

        // Concatenate the values into a single string with periods in between
        const serverIP = `${input1}.${input2}.${input3}.${input4}`;

        // Save the concatenated string to localStorage with the key 'api_server_ip'
        localStorage.setItem('api_server_ip', serverIP);

        // Optionally, log it to the console for confirmation
        console.log('Server IP saved:', serverIP);

        //Call the API
        const URI = `/api/connect`;
        // const URI = `${serverIP}:3000/api/connect`;
        fetch(URI,{
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            if (!response.ok) {
                throw new Error('Incorrect Server IP or Server not responding');
            }
            return response.json();
        }).then(data => {
            console.log('API Response:', data)
        }).catch(error => {
            alert(error);
            console.error('Error'. error);
        })

        // const userAction = async () => {
        //     const response = await fetch(`${serverIP}:3000/api/connect`);
        //     const myJson = await response.json(); //extract JSON from the http response
        //     // do something with myJson
        //     console.log(myJson)
        // }
    }

    // On page load, check if 'api_server_ip' exists in localStorage
    window.onload = function() {
        SQL_editor.getDoc().setValue('SELECT * FROM ')
        const savedIP = localStorage.getItem('api_server_ip');

        // If a saved IP is found, split it into the parts and populate the inputs
        if (savedIP) {
            const parts = savedIP.split('.');
            document.getElementById('input1').value = parts[0] || '000';
            document.getElementById('input2').value = parts[1] || '000';
            document.getElementById('input3').value = parts[2] || '000';
            document.getElementById('input4').value = parts[3] || '000';
        } else {
            // If no saved IP found, default to '000.00.00.000'
            document.getElementById('input1').value = '000';
            document.getElementById('input2').value = '000';
            document.getElementById('input3').value = '000';
            document.getElementById('input4').value = '000';
        }

        // Clear the log box
        // const logBox = document.getElementById('results-box');
        // logBox.value = '';

    }

    // Override console.log to update the log box
    // (function() {
    //     const originalConsoleLog = console.log;
    //     console.log = function(...args) {
    //         // Call the original console.log
    //         originalConsoleLog.apply(console, args);

    //         // Join the arguments into a string and display in the log box
    //         const logMessage = args.join(' ');
    //         const logBox = document.getElementById('results-box');
    //         logBox.value = logMessage;
    //         // logBox.value += logMessage + "\n";  // Append to existing content
    //         // logBox.scrollTop = logBox.scrollHeight;  // Scroll to bottom
    //     };
    // })();

    // Function to submit query and log it
    function submitQuery() {
        SQL_editor.save()
        const query = document.getElementById('query-input').value;
        console.log("Query submitted: " + query);
        // handle the submission logic here
    }

</script>

</body>
</html>